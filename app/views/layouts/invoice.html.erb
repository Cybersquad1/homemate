<!DOCTYPE html>
<html>
<head>
  <title>Invoice</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>

<body>
<div class="invoice container-fluid p-0">
  <div class="w-100 px-4 py-3 bg-light">
    <div class="row">
      <div class="col-md-8 mb-2">
        <h1 class="display-2">Invoice</h1>
      </div>
      <div class="col-md-4 mb-2 text-right">
        <h2>#<%= invoice.hashid %></h2>
      </div>
      <div class="col-md-6">
        <strong><%= tenant.contact.where(primary: true).first.name %></strong><br />
        <%= tenant.contact.where(primary: true).first.readable_address('<br />'.html_safe) %>
      </div>
      <div class="col-md-6">
        <strong>Balance:</strong>
        <%= invoice.readable_balance %>
        <% if invoice.balance_in_credit? %>
        <small>in credit</small>
        <% end %>
        <br />
        <strong>Issued on:</strong> <%= invoice.issued_on.to_s(:rfc822) %><br />
        <strong>Due on:</strong> <%= invoice.due_on.to_s(:rfc822) %>
      </div>
    </div>
  </div>
  <table class="table table-striped w-100">
    <thead>
    <tr>
      <th class="border-top-0">Date</th>
      <th class="border-top-0">Description</th>
      <th class="border-top-0"></th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td></td>
      <td>Balance carried forward</td>
      <td><%= starting_balance %></td>
    </tr>
    <% invoice.transactions.order(credit_date: :asc).each do |t| %>
    <tr>
      <td><%= t.credit_date.to_s(:rfc822) %>></td>
      <td><%= t.description %></td>
      <td><%= t.in_credit? ? '(' + t.readable_amount + ')' : t.readable_amount %></td>
    </tr>
    <% end %>
    </tbody>
    <tfoot>
    <tr>
      <td colspan="2"></td>
      <th><%= invoice.balance_in_credit? ? '(' + @invoice.readable_balance + ')' : @invoice.readable_balance %></th>
    </tr>
    </tfoot>
  </table>
  <% unless @comments.nil? %>
  <div class="card m-4 px-3 py-2">
    <%= comments %>
  </div>
  <% end %>
  <footer class="w-100 px-4 pt-4 pb-3 bg-danger text-white">
    <div class="row">
      <div class="col-md-8">
        <%= tenant.active_tenancy.landlord.contact.where(primary: true).first.name %><br />
        <%= tenant.active_tenancy.landlord.contact.where(primary: true).first.readable_address(' - ') %><br />
        <%= tenant.active_tenancy.landlord.contact.where(primary: true).first.email %>
      </div>
      <div class="col-md-4 text-right">
        <small class="text-light">Generated by <%= link_to('HomeMate', root_url) %></small>
      </div>
    </div>
  </footer>
</div>
</body>
</html>